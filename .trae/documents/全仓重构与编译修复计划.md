## 总体目标
- 全面统一为“结构体 + 上下文 + 可配置客户端”的架构；移除包级包装函数与旧 http 客户端；修复所有编译错误并更新测试。

## 架构原则
- 以领域拆分子包：每个子包提供 Client 结构体与函数式选项（WithTimeout/WithProxy/WithUserAgent/WithClient）。
- 所有外部 HTTP 调用使用 resty.Client，通过包内 http_client.go 或实体持有 client。
- 对外 API 统一以 ctx 入参；不再提供 context.Background() 包装函数。

## 范围与现状排查
- sentiment 已拆分完成，结构清晰，测试已更新：
  - 参考 [sentiment/alist](file:///Users/duxiaoliang/project/stock_quant/go-adata/sentiment/alist/alist.go)、[northflow](file:///Users/duxiaoliang/project/stock_quant/go-adata/sentiment/northflow/northflow.go)、[hot](file:///Users/duxiaoliang/project/stock_quant/go-adata/sentiment/hot/hot.go) 等。
- stock/info/concept 已改为结构体方法：
  - 参考 [concept.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/info/concept/concept.go)
- 仍使用旧 httpc 的模块（需迁移）：
  - capitalflow： [baidu.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/capitalflow/baidu.go)、[east.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/capitalflow/east.go)
  - conceptmarket： [east.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/conceptmarket/east.go)、[ths.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/conceptmarket/ths.go)
  - conceptflow： [east.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/conceptflow/east.go)
  - stock/info/stockindex： [stockindex.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/info/stockindex/stockindex.go)
  - indexmarket： [baidu.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/indexmarket/baidu.go)

## 具体实施步骤
### 1. 移除 httpc 并接入 resty
- 为下列包新增/复用 http_client.go：capitalflow、conceptmarket、conceptflow、stockindex、indexmarket（已存在但文件中仍引入 httpc 的需切换到 getHTTPClient）。
- 将所有 `httpc.NewClient()` 改为包内 `getHTTPClient()` 或实体持有的 `client`，并补充 ctx 传递。

### 2. 引入/统一实体结构体
- capitalflow：新增 Client，方法命名为：
  - Client.MinutesBaidu/Client.DailyBaidu
  - Client.MinutesEast/Client.DailyEast
- conceptmarket：新增 Client，方法命名为：
  - Client.DailyEast/Client.MinuteEast/Client.CurrentEast
  - Client.DailyThs/Client.MinuteThs/Client.CurrentThs
- conceptflow：新增 Client，方法命名为：
  - Client.ListEast(daysType)
- stockindex：新增 Client，方法命名为：
  - Client.AllIndexCodesEast
  - Client.ConstituentBaidu
- indexmarket：将 [baidu.go](file:///Users/duxiaoliang/project/stock_quant/go-adata/stock/market/indexmarket/baidu.go) 切换到包内 resty 客户端并保留 IndexMarket 结构体方法风格。

### 3. 移除包级包装函数
- 搜索并删除仍存在的 `context.Background()` 包装函数；统一要求调用方显式传递 ctx。

### 4. 统一入参与命名
- 方法前缀按来源（East/Baidu/Ths/QQ/Sina）区分，核心动词统一：Daily/Minute/Current/List。
- 时间/代码入参保持一致：stockCode/indexCode/reportDate/startDate/endDate/wait。

### 5. 更新测试
- 为上述包新增或更新测试：
  - capitalflow：验证分钟/日资金流，两来源各 1 用例。
  - conceptmarket：验证东财/同花顺日线/分钟/当前。
  - conceptflow：验证东财榜单分页聚合。
  - stockindex：验证指数代码获取与成分股。
- 将旧测试改为引用子包并使用结构体方法，移除对包级函数的依赖。

### 6. 编译与诊断修复
- 运行 `go build ./...` 与 `go test ./...`，根据报错逐个修复：
  - 删除不存在的 import（common/http）。
  - 修正命名与类型不一致问题（如 parseF、toString 的本地复用）。
  - 处理平台特定 Header/Cookie 的引用（确保 utils/header 可用）。

### 7. 文档与示例
- 在 .trae/doc 增补“市场与情绪子包统一客户端规范”章节，提供最小可用示例。

## 交付物
- 重构 PR 包含：新增子包客户端结构体、删除包装函数、替换 httpc、更新测试。
- 通过本地编译与测试，确保无编译错误，关键接口最少 1 条用例通过。

## 风险与回滚
- 若部分来源接口不可用（临时网络/风控），测试改为跳过（t.Skip）并保留最小试玩用例。
- 所有改动以独立提交分组，便于逐步回滚。
